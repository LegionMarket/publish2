!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(i,n){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(n)&&n),this.init()}var i=e(document),n="qor.publish2",s="enable."+n,o="disable."+n,r="click."+n,a="change."+n,d="qor.selectone.selected qor.selectone.unselected",l=".qor-publish2__version",c="qor-table__inner-list",h="qor-table__inner-block",u="."+c,p="."+h,f=".qor-pulish2__eventid",b=".qor-pulish2__eventid-input",v='[name="QorResource.PublishReady"]',g='[name="QorResource.ScheduledStartAt"]',m='[name="QorResource.ScheduledEndAt"]',y='[name="QorResource.VersionName"]',_='[name="QorResource.ScheduleEventID"]',q=".qor-pulish2__action",E=".qor-pulish2__action-start",T=".qor-pulish2__action-end",C=".qor-pulish2__action-input",S=".qor-action__picker-button",k=".qor-table--medialibrary>tbody>tr",A="qor-table--medialibrary",w="is-showing";return t.prototype={constructor:t,init:function(){this.actionType=this.options.element,this.bind(),this.initActionTemplate()},bind:function(){i.on(r,l,this.loadPublishVersion.bind(this)).on(a,C,this.action.bind(this)).on(d,f,this.eventidChanged.bind(this))},unbind:function(){i.off(r,l,this.loadPublishVersion.bind(this)).off(a,C,this.action.bind(this)).off(d,f,this.eventidChanged.bind(this))},initActionTemplate:function(){e(q).closest(".qor-slideout").size()||e(q).prependTo(e(".mdl-layout__content .qor-page__body")).show()},action:function(t){var i=e(t.target),n="checkbox"==i.prop("type"),s=i.val(),o=e(this.actionType[i.data().actionType]),r=o.closest("label");o.size()&&(n?(o.prop("checked",i.is(":checked")),i.is(":checked")?r.addClass("is-checked"):r.removeClass("is-checked")):o.val(s))},eventidChanged:function(t,i){i?e(b).val(i.primaryKey):e(b).val(""),this.updateDate(i,t.target),e(b).trigger("change")},updateDate:function(t,i){var n=e(i).closest(q),s=n.find(E),o=n.find(T),r=n.find(S),a=r.parent().find("input");t?(s.val(t.ScheduleStartAt),o.val(t.ScheduleEndAt),r.hide(),a.attr("disabled",!0)):(r.show(),a.attr("disabled",!1).closest(".is-disabled").removeClass("is-disabled")),s.trigger("change"),o.trigger("change")},loadPublishVersion:function(t){var i,n=e(t.target),s=n.data().versionUrl,o=n.closest("table"),r=n.closest("tr"),a=r.find("td").size(),d=o.hasClass(A),l=e('<tr class="'+c+'"><td colspan="'+a+'"></td></tr>'),f=e('<div class="'+h+'"><div style="text-align: center;"><div class="mdl-spinner mdl-js-spinner is-active"></div></div></div>');if(r.hasClass(w))return e(u).remove(),o.find("tr").removeClass(w),!1;if(e(u).remove(),o.find("tr").removeClass(w),r.addClass(w),d){var b=e(k),v=parseInt(o.width()/217),g=b.index(r)+1,m=Math.ceil(g/v);r=e(b.get(v*m-1)),r.size()||(r=b.last()),l=e('<tr class="'+c+'" style="width: '+(217*v-16)+'px"><td></td></tr>')}return r.after(l),i=e(u).find("td"),f.appendTo(i).trigger("enable"),s&&e.get(s,function(t){e(p).html(t).trigger("enable")}),!1},destroy:function(){this.unbind(),this.$element.removeData(n)}},e.fn.qorSliderAfterShow.initPublishForm=function(){var i=e(q),n=i.find("[data-action-type]"),s=t.ELEMENT;i.size()&&n.size()&&n.each(function(){var t=e(this);e(s[t.data().actionType]).closest(".qor-form-section").hide()})},t.DEFAULTS={},t.ELEMENT={scheduledstart:g,scheduledend:m,publishready:v,versionname:y,eventid:_},t.plugin=function(i){return this.each(function(){var s,o=e(this),r=o.data(n);if(!r){if(/destroy/.test(i))return;o.data(n,r=new t(this,i))}"string"==typeof i&&e.isFunction(s=r[i])&&s.apply(r)})},e(function(){var i=".qor-theme-publish2",n={};n.element=t.ELEMENT,e(document).on(o,function(n){t.plugin.call(e(i,n.target),"destroy")}).on(s,function(s){t.plugin.call(e(i,s.target),n)}).triggerHandler(s)}),t});